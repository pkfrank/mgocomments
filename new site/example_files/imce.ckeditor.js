(function($,Drupal,CKEDITOR){'use strict';CKEDITOR.plugins.add('imce',{init:function(editor){editor.addCommand('imceimage',{exec:CKEDITOR.imce.imageDialog});editor.ui.addButton('ImceImage',{label:CKEDITOR.imce.imageLabel(),command:'imceimage',icon:editor.config.ImceImageIcon});editor.addCommand('imcelink',{exec:CKEDITOR.imce.linkDialog});editor.ui.addButton('ImceLink',{label:CKEDITOR.imce.linkLabel(),command:'imcelink',icon:editor.config.ImceLinkIcon});}});CKEDITOR.imce=CKEDITOR.imce||{imageLabel:function(){return Drupal.t('Insert images using Imce File Manager');},imageDialog:function(editor){return CKEDITOR.imce.openDialog(editor,'image');},linkLabel:function(){return Drupal.t('Insert file links using Imce File Manager');},linkDialog:function(editor){return CKEDITOR.imce.openDialog(editor,'link');},openDialog:function(editor,type){var width=Math.min(1000,parseInt(screen.availWidth*0.8));var height=Math.min(800,parseInt(screen.availHeight*0.8));var url=CKEDITOR.imce.url('sendto=CKEDITOR.imce.sendto&type='+type+'&ck_id='+encodeURIComponent(editor.name));editor.popup(url,width,height);},sendto:function(File,win){var imce=win.imce;var editor=CKEDITOR.instances[imce.getQuery('ck_id')];if(editor){var i;var text;var lines=[];var selection=imce.getSelection();var is_img=imce.getQuery('type')==='image';for(i in selection){if(!imce.owns(selection,i)){continue;}
File=selection[i];if(is_img&&File.isImageSource()){lines.push('<img src="'+File.getUrl()+'"'+(File.width?' width="'+File.width+'"':'')+(File.height?' height="'+File.height+'"':'')+' alt="'+File.formatName()+'" />');}
else{text=!lines.length&&CKEDITOR.imce.getSelectedHtml(editor)||File.formatName();lines.push('<a href="'+File.getUrl()+'">'+text+'</a>');}}
editor.insertHtml(lines.join('<br />'));}
win.close();},url:function(query){var url=Drupal.url('imce');if(query){url+=(url.indexOf('?')===-1?'?':'&')+query;}
return url;},getSelectedHtml:function(editor){var html='';try{var range=editor.getSelection().getRanges()[0];var div=editor.document.createElement('div');div.append(range.cloneContents());html=div.getHtml();}catch(err){}
return html;}};})(jQuery,Drupal,CKEDITOR);